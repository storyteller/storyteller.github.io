<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8"> 
        <meta charset="utf-8">
        <meta name="generator" content="Bootply" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<title>Storyteller - Instrumenting and Performance Logging</title>
		<link href="/content/bootstrap.min.css" rel="stylesheet" type="text/css" />
		<link href="/content/storyteller.css" rel="stylesheet" type="text/css" />
		<link href="/content/prism.css" rel="stylesheet" type="text/css" />
		<link href="/content/theme.css" rel="stylesheet" type="text/css" />
		
		
        

        <link rel="apple-touch-icon" href="/bootstrap/img/apple-touch-icon.png">
        <link rel="apple-touch-icon" sizes="72x72" href="/bootstrap/img/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="114x114" href="/bootstrap/img/apple-touch-icon-114x114.png">

        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" />

        <!-- CSS code from Bootply.com editor -->
        <link href="/content/affix.css" rel="stylesheet" type="text/css" />
    </head>
    
    <!-- HTML code from Bootply.com editor -->
    
    <body  >

<a href="https://github.com/darthfubumvc/storyteller2"><img style="z-index: 5000; position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>
        
        <nav class="navbar navbar-default navbar-fixed-top" role="banner">
		  <div class="container">
		    <div class="navbar-header">
		      <a href="/" class="navbar-brand">Storyteller</a>
		    </div>
		    <nav class="collapse navbar-collapse" role="navigation">
		      <ul class="nav navbar-nav">
            <li>
              <a href="/tutorial">Tutorial</a>
            </li>
		        <li>
		          <a href="/documentation/getting_started">Getting Started</a>
		        </li>
		        <li>
		          <a href="/documentation">Documentation</a>
		        </li>
		        <li>
		        <li>
<a href="https://gitter.im/DarthFubuMVC/StoryTeller2?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://camo.githubusercontent.com/da2edb525cde1455a622c58c0effc3a90b9a181c/68747470733a2f2f6261646765732e6769747465722e696d2f4a6f696e253230436861742e737667" alt="Join the chat at https://gitter.im/DarthFubuMVC/StoryTeller2" data-canonical-src="https://badges.gitter.im/Join%20Chat.svg" style="max-width:100%;"></a>
		        </li>
		        <li>


		        </li>
		      </ul>

		      <ul class="nav navbar-nav navbar-right">
		      	<li><a href="/documentation/language" title="Crafting the Specification Language">Previous</a></li>
		      	<li><a href="/documentation/ci" title="Integration with Continuous Integration">Next</a></li>
		      </ul>
		    </nav>

		  </div>
		</nav>

		  <div class="container">
		  	<nav class="navbar-inverse">
		  		<ol class="breadcrumb"><li><a href="/">Storyteller</a></li><li><a href="/documentation">Documentation</a></li><li class="active">Instrumenting and Performance Logging</li></ol>
		  	</nav>
		  </div>

		<!--main-->
		<div class="container">
			<div class="row">
		      <!--left-->
		      
		      <div class="col-md-3" id="leftCol">
		      	<h3>Storyteller </h3>
		      	<br />

				<ul class="nav nav-stacked affix" id="sidebar">

		        </ul>

		        	<h3 class="no-margin">Next</h3><p><a href="/documentation/ci">Integration with Continuous Integration</a></p>
		        	<h3 class="no-margin">Previous</h3><a href="/documentation/language">Crafting the Specification Language</a></p>

		        </ul>
		      </div><!--/left-->
		      
		      <!--right-->
		      <div class="col-md-9">
			      	<h1>Instrumenting and Performance Logging</h1>
			      
			      	<hr />

			      	<div id="main-pane">
			      		<!--Title:Instrumenting and Performance Logging-->
<!--Url:instrumentation-->
<p>Since it is an imperfect world, Storyteller specifications will sometimes fail -- and since Storyteller is generally used for integration scenarios and expressed in high level language that purposely disconnected from the code artifacts, it has been difficult from time to time (read: frequently) to trouble shoot failing specifications. At the same time, Storyteller usage has suffered in the past from performance problems and long testing times. While the Storyteller team has invested a lot of time into performance optimizations in Storyteller itself, the 3.0 release has added some long overdue tooling to measure and expose the performance characteristics of the specifications so that teams <strong>can identify where the real throughput problems really are</strong>.</p>
<div class="alert alert-info" role="alert"><strong>Note!</strong> Sometime after the official Storyteller 3.0 release, the team would like to investigating an execution mode that allows you to walk through all the specification steps manually to try to make debugging specification failures easier than it is today.
</div>
<h2>StoryTellerAssert</h2>
<p>The original means of adding more contextual information about specification failures is the old <code>StoryTellerAssert</code> static class, with its usage shown below:</p>
<p>5890a661-7249-45bf-9969-3074b7750cfb</p>
<p>While you can always just throw an exception in a grammar to provide more information about invalid conditions, using this functionality will allow you to add readable contextual error messages into the html results to help explain failures without adding an ugly .Net stacktrace.</p>
<p>A classic example of using <code>StoryTellerAssert</code> is if you have a grammar that is supposed to select a given value in a select box on the screen. If the element is hidden, does not exist, or the desired value is not part of the options, use <code>StoryTellerAssert</code> to make the normally quiet grammar fail with some kind of contextual explanation of why that action is invalid for easier debugging later.</p>
<p>Try not to use <code>StoryTellerAssert</code> in place of <a href="/documentation/engine/grammars/assertions">assertions</a> or <a href="/documentation/engine/grammars/facts">facts</a> -- especially when that results in much more work on your part.</p>
<h2>Debug Output</h2>
<p>If you are compiling to the <code>Debug</code> profile in your local work, any calls to .Net's built in <code>Debug.WriteLine()</code> during the execution of a specification will show up in a section at the very bottom of the specification results html.</p>
<p>The sample below is from the internal specifications on the documentation generation that I introduced to trouble shoot a failing specification one day:</p>
<div data-reactid=".0.1.$spec-editorb2bf7c97-5c10-454e-a068-8f9256376467=2results.1.2:2"><h3 data-reactid=".0.1.$spec-editorb2bf7c97-5c10-454e-a068-8f9256376467=2results.1.2:2.0">Debug Output</h3><div data-reactid=".0.1.$spec-editorb2bf7c97-5c10-454e-a068-8f9256376467=2results.1.2:2.1"><pre class="debug-output">Loading topic file C:\Users\jeremill\AppData\Local\Temp\fc517eaa-8c3b-4d2f-8dc3-e4d0e923bed4\blue.md
Parsing topic file C:\Users\jeremill\AppData\Local\Temp\fc517eaa-8c3b-4d2f-8dc3-e4d0e923bed4\blue.md
Loading topic file C:\Users\jeremill\AppData\Local\Temp\fc517eaa-8c3b-4d2f-8dc3-e4d0e923bed4\index.md
Parsing topic file C:\Users\jeremill\AppData\Local\Temp\fc517eaa-8c3b-4d2f-8dc3-e4d0e923bed4\index.md
Loading topic file C:\Users\jeremill\AppData\Local\Temp\fc517eaa-8c3b-4d2f-8dc3-e4d0e923bed4\lightbrown.md
Parsing topic file C:\Users\jeremill\AppData\Local\Temp\fc517eaa-8c3b-4d2f-8dc3-e4d0e923bed4\lightbrown.md
Loading topic file C:\Users\jeremill\AppData\Local\Temp\fc517eaa-8c3b-4d2f-8dc3-e4d0e923bed4\purple.md
Parsing topic file C:\Users\jeremill\AppData\Local\Temp\fc517eaa-8c3b-4d2f-8dc3-e4d0e923bed4\purple.md
Loading topic file C:\Users\jeremill\AppData\Local\Temp\fc517eaa-8c3b-4d2f-8dc3-e4d0e923bed4\red.md
Parsing topic file C:\Users\jeremill\AppData\Local\Temp\fc517eaa-8c3b-4d2f-8dc3-e4d0e923bed4\red.md
</pre></div><hr data-reactid=".0.1.$spec-editorb2bf7c97-5c10-454e-a068-8f9256376467=2results.1.2:2.2"></div>
<h2>Custom Logging</h2>
<div class="alert alert-info" role="alert"><strong>Note!</strong> The Storyteller HTML rendering uses <a href="http://getbootstrap.com">Bootstrap</a> for all of its styling. You can assume that Bootstrap styles are loaded into any html rendering of your custom html to take advantage of Bootstrap styling.
</div>
<p>A relatively new feature in Storyteller is the ability to add custom HTML to the results report. We originally built this functionality to use Storyteller against a system with quite a bit of distributed messaging where we would write a threaded history of the messages sent, received, and handled by the service bus endpoints during the execution. That has been successful enough that Storyteller 3.0 has formalized and generalized that mechanism.</p>
<p>We are now using the instrumentation extensibility shown below to log the HTTP requests handled by our web application during specifications so that our teams have a much better understanding of just what is going on inside of the system during specification execution. We are also using the custom logging of HTTP requests and service bus message handling to understand where there may be opportunities for performance improvement by combining or batching up HTTP requests made from our client to our server.</p>
<p>The entry point to customized logging is the small <code>IReporting</code> service exposed off of <code>ISpecContext.Reporting</code>:</p>
<p>ece4f6f5-65c5-4b37-a7cf-de3aff9535d7</p>
<p>The <code>ISpecContext</code> service is available as the <code>Context</code> property inside of <code>Fixture</code> classes where it can be used by any <a href="/documentation/engine/grammars">grammar code</a> like in this <a href="/documentation/engine/grammars/sentences">Sentences</a>:</p>
<p>f0596a97-4dac-474c-b705-b7b6db76e977</p>
<p>The reporting is also accessible in the <code>IExecutionContext.AfterExecution()</code> method. We exploit this method to add contextual information from the application's own diagnostics at the end of each specification.</p>
<p>2d45c927-f471-4f4a-9d5b-0e32572e7a27</p>
<p>Another usage of custom reporting to gather up html results in a single section is to use your own <code>IReport</code> implementation:</p>
<p>e00ec9f2-b614-4624-b75d-6f474dc9c8c0</p>
<p>A custom <code>IReport</code> from Storyteller's internal tests is shown below:</p>
<p>b655ff3a-2ed1-4bfd-a9bf-c36c8d5ed9a0</p>
<p>In usage, you can share a custom <code>IReport</code> between grammars and fixtures by using this syntax below:</p>
<p>cd5511e4-24d2-4f8a-89cb-156278db147b</p>


			      	</div>

			      	<hr />

			      	<nav>
				        <span>
				        	<strong>Previous: </strong><a href="/documentation/language">Crafting the Specification Language</a>

				        </span>
				        <span class="pull-right">

				        	<strong>Next: </strong><a href="/documentation/ci">Integration with Continuous Integration</a>

				        </span>
			      	</nav>

		      </div><!--/right-->
		  	</div><!--/row-->
		</div><!--/container-->


    </body>


    <foot>
        <script type='text/javascript' src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script type='text/javascript' src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

        <script type="text/javascript" src="/content/embed.js"></script>
        <script type="text/javascript" src="/content/prism.js"></script>
        <script type="text/javascript" src="/content/sidebar.js"></script>
        <script type="text/javascript" src="/content/affix.js"></script>