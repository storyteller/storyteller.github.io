<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8"> 
        <meta charset="utf-8">
        <meta name="generator" content="Bootply" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<title>Storyteller - Fixtures</title>
		<link href="/content/bootstrap.min.css" rel="stylesheet" type="text/css" />
		<link href="/content/storyteller.css" rel="stylesheet" type="text/css" />
		<link href="/content/prism.css" rel="stylesheet" type="text/css" />
		
        

        <link rel="apple-touch-icon" href="/bootstrap/img/apple-touch-icon.png">
        <link rel="apple-touch-icon" sizes="72x72" href="/bootstrap/img/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="114x114" href="/bootstrap/img/apple-touch-icon-114x114.png">


        <!-- CSS code from Bootply.com editor -->
        <link href="/content/affix.css" rel="stylesheet" type="text/css" />
    </head>
    
    <!-- HTML code from Bootply.com editor -->
    
    <body  >

<a href="https://github.com/darthfubumvc/storyteller2"><img style="z-index: 5000; position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>
        
        <nav class="navbar navbar-default navbar-fixed-top" role="banner">
		  <div class="container">
		    <div class="navbar-header">
		      <a href="/" class="navbar-brand">Storyteller</a>
		    </div>
		    <nav class="collapse navbar-collapse" role="navigation">
		      <ul class="nav navbar-nav">
		        <li>
		          <a href="/getting_started">Get Started</a>
		        </li>
		        <li>
		          <a href="/documentation">Documentation</a>
		        </li>
		        <li>
<a href="https://gitter.im/DarthFubuMVC/StoryTeller2?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://camo.githubusercontent.com/da2edb525cde1455a622c58c0effc3a90b9a181c/68747470733a2f2f6261646765732e6769747465722e696d2f4a6f696e253230436861742e737667" alt="Join the chat at https://gitter.im/DarthFubuMVC/StoryTeller2" data-canonical-src="https://badges.gitter.im/Join%20Chat.svg" style="max-width:100%;"></a>
		        </li>
		        <li>


		        </li>
		      </ul>

		      <ul class="nav navbar-nav navbar-right">
		      	<li><a href="/documentation/language" title="Crafting the Specification Language">Previous</a></li>
		      	<li><a href="/documentation/cells" title="Cells">Next</a></li>
		      </ul>
		    </nav>

		  </div>
		</nav>

		  <div class="container">
		  	<nav class="navbar-inverse">
		  		<ol class="breadcrumb"><li><a href="/">Storyteller</a></li><li><a href="/documentation">Documentation</a></li><li class="active">Fixtures</li></ol>
		  	</nav>
		  </div>

		<!--main-->
		<div class="container">
			<div class="row">
		      <!--left-->
		      
		      <div class="col-md-3" id="leftCol">
		      	<h3>Storyteller </h3>
		      	<br />

				<ul class="nav nav-stacked affix" id="sidebar">

		        </ul>

		        	<h3 class="no-margin">Next</h3><p><a href="/documentation/cells">Cells</a></p>
		        	<h3 class="no-margin">Previous</h3><a href="/documentation/language">Crafting the Specification Language</a></p>

		        </ul>
		      </div><!--/left-->
		      
		      <!--right-->
		      <div class="col-md-9">
			      	<h1>Fixtures</h1>
			      
			      	<hr />

			      	<div id="main-pane">
			      		<!--Title:Fixtures-->
<!--Url:fixtures-->
<div class="alert alert-warning" role="alert"><strong>Warning!</strong> Only one instance of each Fixture class is created and shared across all specification executions in a Storyteller process. This is a breaking change from earlier version. </div>
<p>The specification language in Storyteller starts with implementations of the <code>Fixture</code> class that implement and expose the individual grammars.</p>
<p>A <code>Fixture</code> class has to be a public, concrete class that inherits from <code>Storyteller.Fixture</code> like the class shown below:</p>
<div><pre><code class="language-csharp">
    public class SampleFixture : Fixture
    {
        public SampleFixture()
        {
            Title = "The Sample Fixture";
<pre><code>        // Programmatically adding a Grammar to this Fixture
        this[&quot;SayHello&quot;] 
            = Do(&quot;Say Hello&quot;, c =&gt; Debug.WriteLine(&quot;Well, hello there!&quot;));

    }

    // Add a grammar from a Sentence method
    public void SayGoodbye()
    {
        Debug.WriteLine(&quot;Goodbye.&quot;);
    }

    public IGrammar SayYourName()
    {
        return Do(&quot;Say your name&quot;, c =&gt; Debug.WriteLine(&quot;My name is Storyteller&quot;));
    }

    public override void SetUp()
    {
        // Perform any actions before this Fixture is used during
        // the execution of a section inside a specification
    }

    public override void TearDown()
    {
        // Perform actions at the end of a section
        // when a specification is executed
    }
}
</code></pre>
<p></code></pre></div></p>
<h3>Some things of note:</h3>
<ul>
<li>The idiom is to name the Fixture classes [Something]Fixture, where &quot;Something&quot; would be the default title.</li>
<li>You can use the <code>Title</code> property of a Fixture class to override the title that gets displayed in the generated html. Otherwise, the default is to take the name of the Fixture class and remove the word &quot;Fixture.&quot;</li>
<li>Grammars can be added programmatically in the constructor function, from methods that return <code>IGrammar</code>, and from methods that have either a <code>Void</code> signature or return a single value.</li>
</ul>
<div class="alert alert-info" role="alert"><strong>Info</strong> The initial project team that developed and used Storyteller felt that it was much easier to trace the functionality of the Fixture language to the right place in the code if you primarily used individual methods on the Fixture classes instead of explicitly adding grammars in the constructor function of a Fixture. </div>
<h2>Fixture and Grammars</h2>
<p>The <code>Fixture</code> class holds its grammar objects in a hash that's exposed as an indexer on the object:</p>
<div><pre><code class="language-csharp">
        [IndexerName("Grammars")]
        public IGrammar this[string key]
        {
            get { return _grammars[key]; }
            set
            {
                _grammars[key] = value;
                value.Key = key;
            }
        }
</code></pre></div>
<p>You can both access grammars by name and programmatically add grammar objects to this hashed collection with the C# syntax <code>this[&quot;grammar key&quot;] = myGrammar</code>.</p>
<div class="alert alert-info" role="alert"><strong>Info</strong> As of 3.0, Storyteller is finally smart enough to build named grammars on demand if they are missing, so there's no longer any concern about how the grammars are ordered in the Fixture class.</div>
<h2>Adding Grammars by Method</h2>
<p>Fixture objects find their grammars by reflecting over its <code>Type</code> and looking for any public method whose name matches the requested grammar key. A method that returns an <code>IGrammar</code> object will be executed and the resulting IGrammar object is exposed on the Fixture with the name of the method. See the example below:</p>
<div><pre><code class="language-csharp">
        public IGrammar CheckTopic()
        {
            return Paragraph("Check the properties of a topic at the root of the topic directory", _ =>
            {
                _ += this["ForFile"];
                _ += c => { c.State.CurrentObject = TopicLoader.LoadTopic(_location, true); };
<pre><code>            _.VerifyPropertiesOf&lt;Topic&gt;(x =&gt;
            {
                x.Check(y =&gt; y.Key);
                x.Check(y =&gt; y.Title);
                x.Check(y =&gt; y.UrlSegment);
            });
        });
    }
</code></pre>
<p></code></pre></div></p>
<p>For methods that either have a <code>Void</code> signature or return a value that's not <code>IGrammar</code>, a Fixture object will create a <em>Sentence</em> grammar that will call that method on the Fixture object when it executes a specification.</p>
<p>See <a href="/documentation/grammars/sentences">Sentences</a> for more information.</p>
<h2>Accessing the Context</h2>
<p>The <code>ISpecContext</code> object for the currently executing specification is exposed on Fixture objects through its <code>Context</code> property. The following sample is taken from a Fixture used in Storyteller's internal specifications that tests the documentation generation:</p>
<div><pre><code class="language-csharp">
<pre><code>    // This is taken from a Fixture class that is used
    // internally to test Storyteller's documentation
    // generation
    public override void SetUp()
    {
        _directory = Context.Service&lt;DocSettings&gt;().Root;
    }
</code></pre>
<p></code></pre></div></p>
<p>Note that the <code>Context</code> property is set during execution before any <code>SetUp</code> method or Grammar's from the Section are called. <strong>Only use the <code>Context</code> property and never cache the <code>ISpecContext</code> in a private field to avoid accessing stale data from a previous specification</strong>.</p>
<p>See <a href="/documentation/context">Working with the Spec Context</a> for more information.</p>
<h2>SetUp() and TearDown()</h2>
<p>As the names imply, the <code>SetUp()</code> and <code>TearDown</code> methods are executed before and after any steps when a section using a Fixture executes. Use these methods to do any kind of quiet mechanical actions. Examples from past usage include:</p>
<ul>
<li>Using SetUp() to navigate a browser to a certain Url when testing browser applications</li>
<li>Using TearDown() to commit a transaction in Fixture's that primarily setup system state</li>
<li>Storing information in the Context for another Fixture</li>
</ul>
<h2>Hidden Grammars and Fixtures</h2>
<p>You will occasionaly want to build a grammar that will be used by another grammar, but shouldn't be exposed in the Storyteller editor as a valid choice. In that case, simply mark a grammar with the <code>[Hidden]</code> attribute as shown below:</p>
<div><pre><code class="language-csharp">
<pre><code>    // CaptureLine will not be visible in the user interface for user
    // selection when authoring a specification, but can be used internally
    [Hidden]
    public void CaptureLine(string Text)
    {
        _text.Add(Text);
    }

    public IGrammar WriteFile()
    {
        // The WriteFile grammar uses the CaptureLine grammar
        // as the basis for a table
        return this[&quot;CaptureLine&quot;].AsTable(&quot;The contents are&quot;)
            .After(() =&gt;
            {
                new FileSystem().WriteToFlatFile(_location, writer =&gt; _text.Each(writer.WriteLine));
            });
    }
</code></pre>
<p></code></pre></div></p>
<p>In the same token, if you have a <code>Fixture</code> class than will be used as an embedded section, but never by itself as a top level section, decorate a <code>Fixture</code> class with the <code>[Hidden]</code> attribute as shown below:</p>
<div><pre><code class="language-csharp">
    [Hidden]
    public class SecretFixture : Fixture
    {
<pre><code>}
</code></pre>
<p></code></pre></div></p>


			      	</div>

			      	<hr />

			      	<nav>
				        <span>
				        	<strong>Previous: </strong><a href="/documentation/language">Crafting the Specification Language</a>

				        </span>
				        <span class="pull-right">

				        	<strong>Next: </strong><a href="/documentation/cells">Cells</a>

				        </span>
			      	</nav>

		      </div><!--/right-->
		  	</div><!--/row-->
		</div><!--/container-->


    </body>


    <foot>
        <script type='text/javascript' src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script type='text/javascript' src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

        <script type="text/javascript" src="/content/embed.js"></script>
        <script type="text/javascript" src="/content/prism.js"></script>
        <script type="text/javascript" src="/content/sidebar.js"></script>
        <script type="text/javascript" src="/content/affix.js"></script>
    </foot>
</html>

